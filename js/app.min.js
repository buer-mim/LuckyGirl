!function(t,e){e.get=function(t){var e={link:"81de98f70f97e7b3f0f87cfb96cd2522",barColor:"#EF5350",barTextColor:"UIStatusBarStyleBlackOpaque",noLoginPages:["login"],region:"成都市",server:"http://youka.svn.biantikeji.com/",uptime:3600};return e[t]}}(mui,window.config={}),function(t,e){e.debug=function(t){t=JSON.stringify(t),console.log(t)},e.Udate=function(t,e){if(!t)return"";{var i=new Date(1e3*t),n=i.getFullYear(),s=i.getMonth()+1,a=i.getDate(),o=i.getHours(),l=i.getMinutes();i.getSeconds()}return e=e?e:1,1==e?n+"-"+s+"-"+a+"   "+o+":"+l:2==e?n+"-"+s+"-"+a:3==e?n+"年"+s+"月"+a+"日":4==e?s+"月"+a+"日":void 0}}(mui,window.tools={}),function(t,e){e.open=function(e,i){"undefined"==typeof i&&(i={}),t.plusReady(function(){if(tools.debug("open:"+e),"index"!==e){var n=e.split("/"),s=user.check();-1!=$.inArray(n[0],config.get("noLoginPages"))||s?auth.getInfo():(tools.debug("权限错误"),e="login/login");var a=e;e=apptpl+e+".html",t.openWindow({url:e,id:a,styles:{top:"0",bounce:"vertical"},show:{autoShow:!0,aniShow:"lide-in-right",duration:100},waiting:{autoShow:!0},extras:i})}else for(var o=plus.webview.all(),l=0;l<o.length;l++)o[l].id!==plus.webview.getLaunchWebview().id&&plus.webview.close(o[l])})},e.receive=function(e,i){t.plusReady(function(){window.addEventListener(e,function(t){tools.debug("receive : "+e);var n=t.detail?t.detail:{data:null};i(n.data)})})},e.send=function(e,i,n){t.plusReady(function(){tools.debug("send : "+e),t.fire(plus.webview.getWebviewById(e),i,{data:n})})},e.bindData=function(t,e){e=e||0,$.each(t,function(t,i){e?$("#bind-"+t).html(i):$("#bind-"+t).val(i)})}}(mui,window.windows={}),function(t,e){e.get=function(t){var e=window.localStorage.getItem(t.toString());return e?JSON.parse(e).data:null},e.set=function(t,e){var i=JSON.stringify({data:e});return window.localStorage.setItem(t.toString(),i)},e.del=function(t){return window.localStorage.removeItem(t)}}(mui,window.database={}),function(t,e){e.bind=function(i,n,s){t.plusReady(function(){$(i).on("tap","[data-submit]",function(){plus.nativeUI.showWaiting();var t=e.getFormData(i);http.post($(i).attr("action"),t,function(t,e){"function"==typeof s&&s(e.message,e.result),plus.nativeUI.closeWaiting(),plus.nativeUI.toast(t),console.log("sdfsdadf");var n=$(i).data("success");n&&window[n](t,e)},function(t,e){plus.nativeUI.closeWaiting();var n=$(i).data("error");n&&window[n](t,e)})})})},e.getFormData=function(t){var e={},i=$(t).serializeArray();return $.each(i,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),tools.debug(e),e}}(mui,window.form={}),function(t,e){e.post=function(t,i,n,s){e.go("post",t,i,n,s)},e.get=function(t,i,n,s){e.go("get",t,i,n,s)},e.data=function(t){var e=database.get("auth");e=e?e:{};var i={auth_link:config.get("link"),auth_uid:e.uid?e.uid:null,auth_token:e.token?e.token:null};return $.extend(i,t)},e.go=function(i,n,s,a,o){var s=e.data(s);t.plusReady(function(){tools.debug(n),tools.debug(s),t.ajax(config.get("server")+n,{dataType:"json",type:i,timeout:1e4,data:s,success:function(t){return 200!=t.code?(plus.nativeUI.closeWaiting(),plus.nativeUI.toast(t.message),!1):(tools.debug(t),setTimeout(function(){plus.nativeUI.closeWaiting()},500),void("function"==typeof a&&a(t.message,t.result)))},error:function(t){setTimeout(function(){plus.nativeUI.closeWaiting(),tools.debug(t.responseText)},500);var i=JSON.parse(t.responseText);e.error(i,t.status,o)}})})},e.upload=function(i,n,s,a,o){var s=e.data(s);t.plusReady(function(){var t=plus.uploader.createUpload(config.get("server")+i,{method:"POST",blocksize:-1,priority:100},function(t,i){tools.debug(t);var n=JSON.parse(t.responseText);return tools.debug(n),200!=i?(e.error(n,i,o),!1):(plus.nativeUI.toast(n.message),void("function"==typeof a&&a(n.message,n.result)))});$.each(s,function(e,i){t.addData(e,i)}),$.each(n,function(e,i){t.addFile(i,{key:e})}),t.addEventListener("statechanged",function(t){switch(t.state){case 1:plus.nativeUI.showWaiting();break;case 2:break;case 3:{t.uploadedSize/t.totalSize*100}break;case 4:plus.nativeUI.closeWaiting()}}),t.start()})},e.images=function(i,n,s){tools.debug("upload-images"),t.plusReady(function(){plus.nativeUI.actionSheet({cancel:"取消",buttons:[{title:"拍照"},{title:"从相册选取"}]},function(t){if(1==t.index){var a=plus.camera.getCamera(),o="400*800",l="jpg";a.captureImage(function(t){e.upload(i,{file:t},{},n,s)},function(){},{resolution:o,format:l})}2==t.index&&plus.gallery.pick(function(t){e.upload(i,{file:t},{},n,s)},function(){},{filter:"image"})})})},e.error=function(t,e,i){var n=t.message?t.message:"服务器繁忙,请稍后再试!";plus.nativeUI.toast(n),401==e&&windows.open("login/login"),"function"==typeof i&&i(n,e)}}(mui,window.http={}),function(t,e){e.login=function(t){return t.uid?(database.set("auth",{uid:t.uid,token:t.token}),void database.set("user",{info:t.info,time:parseInt((new Date).getTime()/100)})):(plus.nativeUI.toast("授权失败"),!1)},e.getInfo=function(t){var i=database.get("user"),n=parseInt((new Date).getTime()/100);if(i.time+config.get("uptime")<n)e.update(t);else{var s=i.info;"function"==typeof t&&t(s)}},e.update=function(t){http.post("api/Account/getUserInfo",{},function(i,n){n||e.getInfo(function(t){n=t}),database.set("user",{info:n,time:parseInt((new Date).getTime()/100)}),windows.send("user/index","update",n),windows.send("index","update",n),auth.update(),"function"==typeof t&&t(n)})},e.out=function(){database.del("auth"),database.del("user"),auth.clear()},e.check=function(){var t=database.get("auth");return t?"undefined"==t.uid||"undefined"==t.token?!1:!0:!1}}(mui,window.user={}),function(t,e){e.list=function(e,i,n){n=n?n:{},t.init({pullRefresh:{container:"#pullrefresh",down:{callback:function(){vm.listPage(e,n)}},up:{contentrefresh:"正在加载...",callback:function(){vm.listPage(e,n)},auto:!0}}}),i&&(t.os.plus?t.plusReady(function(){setTimeout(function(){t("#pullrefresh").pullRefresh().pullupLoading()},100)}):t.ready(function(){t("#pullrefresh").pullRefresh().pullupLoading()}))},e.tablist=function(e,i,n){n=n?n:{},function(i){var s=t.os.ios?.003:9e-4;i(".mui-scroll-wrapper").scroll({bounce:!1,indicators:!0,deceleration:s}),i.ready(function(){i.each(document.querySelectorAll(".mui-slider-group .mui-scroll"),function(t,s){i(s).pullToRefresh({up:{callback:function(){var t=this,i=t.element.querySelector(".mui-table-view");setTimeout(function(){vm.tabListPage(t,i,e,n),t.endPullUpToRefresh()},1e3)},auto:!0}})})})}(t,jQuery)},e.tabNewlist=function(e,i){!function(n){var s=t.os.ios?.003:9e-4;n(".mui-scroll-wrapper").scroll({bounce:!1,indicators:!0,deceleration:s}),n.ready(function(){n.each(document.querySelectorAll(".mui-slider-group .mui-scroll"),function(t,s){n(s).pullToRefresh({down:{callback:function(){var t=this,e=t.element.querySelector(".mui-table-view");"function"==typeof i&&i(t,e)}},up:{callback:function(){var t=this,i=t.element.querySelector(".mui-table-view");"function"==typeof e&&e(t,i)},auto:!0}})})})}(t,jQuery)},e.tabPage=function(){!function(e){t.os.ios?.003:9e-4;e(".mui-scroll-wrapper").scroll({indicators:!0})}(t,jQuery)},e.upList=function(t){vm.page=1,vm.items=[],vm.listPage(t)}}(mui,window.page={}),function(t,e){e.alipay=function(t,e,i,n){function s(t){if(!t.serviceReady){var e=null;switch(t.id){case"alipay":e="检测到系统未安装“支付宝快捷支付服务”，无法完成支付操作，是否立即安装？";break;default:e="系统未安装“"+t.description+"”服务，无法完成支付，是否立即安装？"}plus.nativeUI.confirm(e,function(e){0==e.index&&t.installService()},t.description)}}var a=null;plus.payment.getChannels(function(t){for(var e in t)"alipay"==t[e].id&&(a=t[e],s(a))},function(t){plus.nativeUI.alert("获取支付通道失败："+t.message)}),http.post(t,e,function(t,e){plus.payment.request(a,e,function(){"function"==typeof i&&i()},function(t){return tools.debug(t),plus.nativeUI.toast("支付失败，请重新操作！"),"function"==typeof n&&n(),!1})})}}(mui,window.pay={}),function(t,e,i){var n="beforeChangeOffset",s="afterChangeOffset",a="pullstart",o="pulling",l=n,u=s,r="dragEndAfterChangeOffset",p=t.className("transitioning"),c=t.className("pull-top-tips"),d=t.className("pull-bottom-tips"),f=t.className("pull-loading"),g=t.className("scroll"),h=t.className("pull-loading")+" "+t.className("icon")+" "+t.className("icon-pulldown"),m=h+" "+t.className("reverse"),v=t.className("pull-loading")+" "+t.className("spinner"),w=t.className("hidden"),b="."+f;t.PullToRefresh=t.Class.extend({init:function(e,i){this.element=e,this.options=t.extend(!0,{down:{height:75,callback:!1},up:{auto:!1,offset:100,show:!0,contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了",callback:!1},preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/}},i),this.stopped=this.isNeedRefresh=this.isDragging=!1,this.state=n,this.isInScroll=this.element.classList.contains(g),this.initPullUpTips(),this.initEvent()},_preventDefaultException:function(t,e){for(var i in e)if(e[i].test(t[i]))return!0;return!1},initEvent:function(){t.isFunction(this.options.down.callback)&&(this.element.addEventListener("touchstart",this),this.element.addEventListener("drag",this),this.element.addEventListener("dragend",this)),this.pullUpTips&&(this.element.addEventListener("dragup",this),this.isInScroll?this.element.addEventListener("scrollbottom",this):e.addEventListener("scroll",this))},handleEvent:function(t){switch(t.type){case"touchstart":this.isInScroll&&this._canPullDown()&&t.target&&!this._preventDefaultException(t.target,this.options.preventDefaultException)&&t.preventDefault();break;case"drag":this._drag(t);break;case"dragend":this._dragend(t);break;case"webkitTransitionEnd":this._transitionEnd(t);break;case"dragup":case"scroll":this._dragup(t);break;case"scrollbottom":this.pullUpLoading(t)}},initPullDownTips:function(){var e=this;t.isFunction(e.options.down.callback)&&(e.pullDownTips=function(){var t=i.querySelector("."+c);return t&&t.parentNode.removeChild(t),t||(t=i.createElement("div"),t.classList.add(c),t.innerHTML='<div class="mui-pull-top-wrapper"><span class="mui-pull-loading mui-icon mui-icon-pulldown"></span></div>',t.addEventListener("webkitTransitionEnd",e)),e.pullDownTipsIcon=t.querySelector(b),i.body.appendChild(t),t}())},initPullUpTips:function(){var e=this;t.isFunction(e.options.up.callback)&&(e.pullUpTips=function(){var t=e.element.querySelector("."+d);return t||(t=i.createElement("div"),t.classList.add(d),e.options.up.show||t.classList.add(w),t.innerHTML='<div class="mui-pull-bottom-wrapper"><span class="mui-pull-loading">'+e.options.up.contentdown+"</span></div>",e.element.appendChild(t)),e.pullUpTipsIcon=t.querySelector(b),t}())},_transitionEnd:function(t){t.target===this.pullDownTips&&this.removing&&this.removePullDownTips()},_dragup:function(e){var i=this;if(!i.loading){if(e&&e.detail&&t.gestures.session.drag)i.isDraggingUp=!0;else if(!i.isDraggingUp)return;i.isDragging||i._canPullUp()&&i.pullUpLoading(e)}},_canPullUp:function(){if(this.removing)return!1;if(this.isInScroll){var n=this.element.parentNode.getAttribute("data-scroll");if(n){var s=t.data[n];return s.y===s.maxScrollY}}return e.pageYOffset+e.innerHeight+this.options.up.offset>=i.documentElement.scrollHeight},_canPullDown:function(){if(this.removing)return!1;if(this.isInScroll){var e=this.element.parentNode.getAttribute("data-scroll");if(e){var n=t.data[e];return 0===n.y}}return 0===i.body.scrollTop},_drag:function(a){if(this.loading||this.stopped)return a.stopPropagation(),void a.detail.gesture.preventDefault();var o=a.detail;if(!this.isDragging&&"down"===o.direction&&this._canPullDown()){if(i.querySelector("."+c))return a.stopPropagation(),void a.detail.gesture.preventDefault();this.isDragging=!0,this.removing=!1,this.startDeltaY=o.deltaY,t.gestures.session.lockDirection=!0,t.gestures.session.startDirection=o.direction,this._pullStart(this.startDeltaY)}if(this.isDragging){a.stopPropagation(),a.detail.gesture.preventDefault();var l=o.deltaY-this.startDeltaY;l=Math.min(l,1.5*this.options.down.height),this.deltaY=l,this._pulling(l);var u=l>this.options.down.height?s:n;if(this.state!==u&&(this.state=u,this.state===s?(this.removing=!1,this.isNeedRefresh=!0):(this.removing=!0,this.isNeedRefresh=!1),this["_"+u](l)),t.os.ios&&parseFloat(t.os.version)>=8){var r=o.gesture.touches[0].clientY;if(r+10>e.innerHeight||10>r)return void this._dragend(a)}}},_dragend:function(){var t=this;t.isDragging&&(t.isDragging=!1,t._dragEndAfterChangeOffset(t.isNeedRefresh)),t.isPullingUp&&(t.pullingUpTimeout&&clearTimeout(t.pullingUpTimeout),t.pullingUpTimeout=setTimeout(function(){t.isPullingUp=!1},1e3))},_pullStart:function(e){this.pullStart(e),t.trigger(this.element,a,{api:this,startDeltaY:e})},_pulling:function(e){this.pulling(e),t.trigger(this.element,o,{api:this,deltaY:e})},_beforeChangeOffset:function(e){this.beforeChangeOffset(e),t.trigger(this.element,l,{api:this,deltaY:e})},_afterChangeOffset:function(e){this.afterChangeOffset(e),t.trigger(this.element,u,{api:this,deltaY:e})},_dragEndAfterChangeOffset:function(e){this.dragEndAfterChangeOffset(e),t.trigger(this.element,r,{api:this,isNeedRefresh:e})},removePullDownTips:function(){if(this.pullDownTips)try{this.pullDownTips.parentNode&&this.pullDownTips.parentNode.removeChild(this.pullDownTips),this.pullDownTips=null,this.removing=!1}catch(t){}},pullStart:function(t){this.initPullDownTips(t)},pulling:function(t){this.pullDownTips.style.webkitTransform="translate3d(0,"+t+"px,0)"},beforeChangeOffset:function(){this.pullDownTipsIcon.className=h},afterChangeOffset:function(){this.pullDownTipsIcon.className=m},dragEndAfterChangeOffset:function(t){t?(this.pullDownTipsIcon.className=v,this.pullDownLoading()):(this.pullDownTipsIcon.className=h,this.endPullDownToRefresh())},pullDownLoading:function(){if(!this.loading){if(!this.pullDownTips)return this.initPullDownTips(),void this.dragEndAfterChangeOffset(!0);this.loading=!0,this.pullDownTips.classList.add(p),this.pullDownTips.style.webkitTransform="translate3d(0,"+this.options.down.height+"px,0)",this.options.down.callback.apply(this)}},pullUpLoading:function(t){this.loading||this.finished||(this.loading=!0,this.isDraggingUp=!1,this.pullUpTips.classList.remove(w),t&&t.detail&&t.detail.gesture&&t.detail.gesture.preventDefault(),this.pullUpTipsIcon.innerHTML=this.options.up.contentrefresh,this.options.up.callback.apply(this))},endPullDownToRefresh:function(){this.loading=!1,this.pullUpTips&&this.pullUpTips.classList.remove(w),this.pullDownTips.classList.add(p),this.pullDownTips.style.webkitTransform="translate3d(0,0,0)",this.deltaY<=0?this.removePullDownTips():this.removing=!0},endPullUpToRefresh:function(t){t?(this.finished=!0,this.pullUpTipsIcon.innerHTML=this.options.up.contentnomore,this.element.removeEventListener("dragup",this),e.removeEventListener("scroll",this)):this.pullUpTipsIcon.innerHTML=this.options.up.contentdown,this.loading=!1},setStopped:function(t){t!=this.stopped&&(this.stopped=t,this.pullUpTips&&this.pullUpTips.classList[t?"add":"remove"](w))},refresh:function(t){t&&this.finished&&this.pullUpTipsIcon&&(this.pullUpTipsIcon.innerHTML=this.options.up.contentdown,this.element.addEventListener("dragup",this),e.addEventListener("scroll",this),this.finished=!1)}}),t.fn.pullToRefresh=function(e){var i=[];return e=e||{},this.each(function(){var n=this,s=null,a=n.getAttribute("data-pullToRefresh");a?s=t.data[a]:(a=++t.uuid,t.data[a]=s=new t.PullToRefresh(n,e),n.setAttribute("data-pullToRefresh",a)),e.up&&e.up.auto&&s.pullUpLoading(),i.push(s)}),1===i.length?i[0]:i}}(mui,window,document),mui.plusReady(function(){database.get("region")||database.set("region",config.get("region"))}),Vue.filter("date",function(t,e){if(!t)return"";{var i=new Date(1e3*t),n=i.getFullYear(),s=i.getMonth()+1,a=i.getDate(),o=i.getHours(),l=i.getMinutes();i.getSeconds()}return e=e?e:1,1==e?n+"-"+s+"-"+a+"   "+o+":"+l:2==e?n+"-"+s+"-"+a:3==e?n+"年"+s+"月"+a+"日":4==e?s+"月"+a+"日":void 0}),Vue.filter("hide",function(t){s=String(t);var e=s.length-4;if(0>=e)return s;for(var i=s.substr(0,2),n=s.substr(s.length-2),a="",o=0;e>o;o++)a+="*";return i+a+n}),Vue.mixin({methods:{submit:function(){var t=this;plus.nativeUI.showWaiting(),http.post($("form").attr("action"),this.$data,function(e,i){plus.nativeUI.closeWaiting(),plus.nativeUI.toast(e),t.success&&t.success(e,i)},function(e,i){plus.nativeUI.closeWaiting(),t.error&&t.error(e,i)})},listPage:function(t,e){param=$.extend({page:vm.page},e),http.post(t,param,function(t,e){e.data&&$.each(e.data,function(t,e){vm.items.push(e)}),vm.loading=0,vm.page=e.cur_page+1,mui("#pullrefresh").pullRefresh().endPullupToRefresh(e.count_page>e.cur_page?!1:!0)},function(){vm.loading=0,mui("#pullrefresh").pullRefresh().endPullupToRefresh(!0)})},tabListPage:function(t,e,i,n){n.type=e.getAttribute("data-type"),param=$.extend({page:vm.page},n);var s=e.getAttribute("data-id");vm[s]||(vm[s]=[]),http.post(i,param,function(e,i){i.data&&$.each(i.data,function(t,e){vm[s].push(e)}),vm.loading=0,vm.page=i.cur_page+1,t.endPullUpToRefresh(i.count_page>i.cur_page?!1:!0)},function(){plus.nativeUI.closeWaiting(),vm.loading=0,t.endPullUpToRefresh(!1)})},sltDate:function(t){plus.nativeUI.pickDate(function(e){var i=e.date;vm[t]=i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate()})},sltLocation:function(t){var e=new mui.PopPicker({layer:3});e.setData(cityData),e.show(function(e){vm[t]=e[0].text+" "+e[1].text+" "+e[2].text})}}}),function(t,e){e.getInfo=function(t){var i=database.get("autoUser");i||e.update(t);var n=parseInt((new Date).getTime()/100);if(i.time+config.get("uptime")<n)e.update(t);else{var s=i.info;"function"==typeof t&&t(s)}},e.update=function(t){http.post("api/Auth/getAuth",{},function(e,i){database.set("autoUser",{info:i,time:parseInt((new Date).getTime()/100)}),"function"==typeof t&&t(i)})},e.clear=function(){database.del("autoUser")}}(mui,window.auth={});var ApiRootHost="http://youka.svn.biantikeji.com/",ImageHost="",apptpl="/page/";mui.plusReady(function(){plus.webview.currentWebview().setStyle({scrollIndicator:"none"}),plus.navigator.setStatusBarStyle(config.get("barTextColor")),mui.init({swipeBack:!1,statusBarBackground:config.get("barColor")});var first=null;mui.back=function(){var t=plus.webview.currentWebview();t.id==plus.webview.getLaunchWebview().id?first?(new Date).getTime()-first<1e3&&plus.runtime.quit():(first=(new Date).getTime(),mui.toast("再按一次退出应用"),setTimeout(function(){first=null},1e3)):t.close()},$("body").on("tap","[data-url]",function(e){e.stopPropagation();var url=$(this).data("url"),data=$(this).data("params");return data&&(data=eval("("+data+")")),windows.open(url,data),!1}),$("body").on("tap","[data-back]",function(){return mui.currentWebview.close(),!1}),$("[data-dux]").each(function(){var t=$(this).data(),e=t.dux,i=e.split("-",2);window[i[0]][i[1]](this,t)})});